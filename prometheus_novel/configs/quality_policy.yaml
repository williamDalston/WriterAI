# Quality polish policy â€” genre presets + ceiling rules + meter thresholds.
# Project-level overrides go in project config.yaml under `quality_policy:`.

default_preset: romance

presets:
  romance:
    outline_diversity:
      mode: warn
      window: 5
      adjacent_threshold: 0.80
      window_threshold: 0.70
      # BOND > 35% makes pacing flat; target 25-30%
      max_same_function_ratio: 0.35
      max_regen_attempts: 2
    profile_completeness:
      mode: warn
      min_score: 0.70
      major_role_threshold: 0.80
      auto_patch: true
    ceiling:
      max_edits_per_scene: 15
      max_edits_per_1k_words: 8.0
      max_per_family_per_chapter: 5
      max_pct_sentences_changed: 20.0
    phrase_suppression:
      keep_first_default: 2
      enabled: true
    dialogue_trimming:
      max_tag_words: 12
      enabled: true
    emotion_diversification:
      keep_first: 2
      density_threshold: 5.0
      enabled: true
    cliche_clusters:
      only_flagged: true
      enabled: true
    quality_meters:
      voice_overlap_threshold: 0.55
      lexical_diversity_min: 0.40
      dialogue_variance_min: 0.01
      emotional_entropy_min: 1.5
      verb_specificity_min: 0.30
      ending_evenness_min: 0.40
      max_hot_phrases_feedback: 15
      scorecard_weights:
        mode: weighted
        pass_score: 0.70
        lexical_diversity:
          weight: 0.15
          action_on_fail: warn
        dialogue_density:
          weight: 0.20
          action_on_fail: warn
        emotional_diversity:
          weight: 0.25
          action_on_fail: warn
        verb_specificity:
          weight: 0.15
          action_on_fail: warn
        scene_endings:
          weight: 0.25
          action_on_fail: fail
      scorecard_regression:
        enabled: true
        compare_to: last_successful
        regression_threshold: 0.05
        warn_on_regression: true
        fail_on_regression: false
        max_history: 50
    enabled_passes:
      - phrase_mining
      - phrase_suppression
      - dialogue_trimming
      - emotion_diversification
      - cliche_repair
      - sensory_motif_swap
    crisis_device:
      enabled: false  # not relevant for romance
    chapter_count:
      enforce_mode: warn
      retry_on_shortfall: true

  thriller:
    outline_diversity:
      mode: warn
      window: 5
      adjacent_threshold: 0.85
      window_threshold: 0.75
      # Thrillers tolerate more PURSUIT monotony (chase sequences chain)
      max_same_function_ratio: 0.50
      max_regen_attempts: 2
    profile_completeness:
      mode: warn
      min_score: 0.65
      major_role_threshold: 0.75
      auto_patch: true
    ceiling:
      max_edits_per_scene: 10
      max_edits_per_1k_words: 5.0
      max_per_family_per_chapter: 4
      max_pct_sentences_changed: 15.0
    phrase_suppression:
      keep_first_default: 3
      enabled: true
    dialogue_trimming:
      max_tag_words: 10
      enabled: true
    emotion_diversification:
      keep_first: 3
      density_threshold: 8.0
      enabled: true
    cliche_clusters:
      only_flagged: true
      enabled: true
    quality_meters:
      voice_overlap_threshold: 0.50
      lexical_diversity_min: 0.45
      dialogue_variance_min: 0.015
      emotional_entropy_min: 1.2
      verb_specificity_min: 0.35
      ending_evenness_min: 0.45
      max_hot_phrases_feedback: 20
      scorecard_weights:
        mode: weighted
        pass_score: 0.70
        lexical_diversity:
          weight: 0.15
          action_on_fail: warn
        dialogue_density:
          weight: 0.15
          action_on_fail: warn
        emotional_diversity:
          weight: 0.15
          action_on_fail: warn
        verb_specificity:
          weight: 0.30
          action_on_fail: fail
        scene_endings:
          weight: 0.25
          action_on_fail: fail
      scorecard_regression:
        enabled: true
        compare_to: last_successful
        regression_threshold: 0.05
        warn_on_regression: true
        fail_on_regression: false
        max_history: 50
    enabled_passes:
      - phrase_mining
      - phrase_suppression
      - dialogue_trimming
      - cliche_repair
      - sensory_motif_swap
    crisis_device:
      enabled: true
      lookback_chapters: 2  # thrillers need tight device variety
    chapter_count:
      enforce_mode: strict  # thrillers need full arc
      shortfall_threshold_pct: 20.0
      retry_on_shortfall: true

  literary:
    outline_diversity:
      mode: strict
      window: 6
      adjacent_threshold: 0.70
      window_threshold: 0.60
      # Literary demands maximum variety
      max_same_function_ratio: 0.35
      max_regen_attempts: 3
    profile_completeness:
      mode: strict
      min_score: 0.80
      major_role_threshold: 0.90
      auto_patch: true
    ceiling:
      max_edits_per_scene: 8
      max_edits_per_1k_words: 4.0
      max_per_family_per_chapter: 3
      max_pct_sentences_changed: 12.0
    phrase_suppression:
      keep_first_default: 3
      enabled: true
    dialogue_trimming:
      max_tag_words: 15
      enabled: true
    emotion_diversification:
      keep_first: 3
      density_threshold: 10.0
      enabled: true
    cliche_clusters:
      # Literary: repair even below-threshold clusters
      only_flagged: false
      enabled: true
    quality_meters:
      voice_overlap_threshold: 0.45
      lexical_diversity_min: 0.50
      dialogue_variance_min: 0.02
      emotional_entropy_min: 1.8
      verb_specificity_min: 0.35
      ending_evenness_min: 0.50
      max_hot_phrases_feedback: 12
      scorecard_weights:
        mode: weighted
        pass_score: 0.75
        lexical_diversity:
          weight: 0.25
          action_on_fail: fail
        dialogue_density:
          weight: 0.15
          action_on_fail: warn
        emotional_diversity:
          weight: 0.30
          action_on_fail: fail
        verb_specificity:
          weight: 0.15
          action_on_fail: warn
        scene_endings:
          weight: 0.15
          action_on_fail: warn
      scorecard_regression:
        enabled: true
        compare_to: last_successful
        regression_threshold: 0.05
        warn_on_regression: true
        fail_on_regression: false
        max_history: 50
    enabled_passes:
      - phrase_mining
      - phrase_suppression
      - dialogue_trimming
      - emotion_diversification
      - cliche_repair
      - sensory_motif_swap
    crisis_device:
      enabled: false  # not relevant for literary fiction
    chapter_count:
      enforce_mode: strict
      retry_on_shortfall: true

  fantasy:
    outline_diversity:
      mode: warn
      window: 5
      adjacent_threshold: 0.80
      window_threshold: 0.70
      # Fantasy tolerates repeated locations (world-building settings)
      max_same_function_ratio: 0.45
      max_regen_attempts: 2
    profile_completeness:
      mode: warn
      min_score: 0.70
      major_role_threshold: 0.80
      auto_patch: true
    ceiling:
      max_edits_per_scene: 12
      max_edits_per_1k_words: 6.0
      max_per_family_per_chapter: 5
      max_pct_sentences_changed: 18.0
    phrase_suppression:
      keep_first_default: 2
      enabled: true
    dialogue_trimming:
      max_tag_words: 14
      enabled: true
    emotion_diversification:
      keep_first: 2
      density_threshold: 6.0
      enabled: true
    cliche_clusters:
      only_flagged: true
      enabled: true
    quality_meters:
      voice_overlap_threshold: 0.55
      lexical_diversity_min: 0.42
      dialogue_variance_min: 0.01
      emotional_entropy_min: 1.5
      verb_specificity_min: 0.30
      ending_evenness_min: 0.40
      max_hot_phrases_feedback: 18
      scorecard_weights:
        mode: weighted
        pass_score: 0.70
        lexical_diversity:
          weight: 0.20
          action_on_fail: warn
        dialogue_density:
          weight: 0.15
          action_on_fail: warn
        emotional_diversity:
          weight: 0.25
          action_on_fail: warn
        verb_specificity:
          weight: 0.20
          action_on_fail: warn
        scene_endings:
          weight: 0.20
          action_on_fail: warn
      scorecard_regression:
        enabled: true
        compare_to: last_successful
        regression_threshold: 0.05
        warn_on_regression: true
        fail_on_regression: false
        max_history: 50
    enabled_passes:
      - phrase_mining
      - phrase_suppression
      - dialogue_trimming
      - emotion_diversification
      - cliche_repair
      - sensory_motif_swap
    crisis_device:
      enabled: true
      lookback_chapters: 3  # fantasy has longer arcs, wider window
    chapter_count:
      enforce_mode: warn
      retry_on_shortfall: true
